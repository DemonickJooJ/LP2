Essa ai foi dificil, e no final das contas não consegui fazer, aparentemente foi problema na declaração das variáveis, mas ok, acontece.

